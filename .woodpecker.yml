# .woodpecker.yml
pipeline:
  build:
    image: jekyll/jekyll
    secrets: [ codeberg_access_token ]
    commands:
      - echo $CODEBERG_ACCESS_TOKEN
      - chmod -R 777 .
      - bundle install
      - bundle exec jekyll build
      - git config --global --add safe.directory /woodpecker/src/codeberg.org/jwildeboer/fedigridsource/_site
      - cp domains _site/.domains
      - cd _site
      - git init
      - git branch -m pages
      - git config user.email "jan@wildeboer.net"
      - git config --global user.name "CI Builder"
      - git add --all
      - git commit -m "CI Build"
      - git remote add up $CODEBERG_ACCESS_TOKEN@https://codeberg.org/jwildeboer/fedigrid.git
      - git push -u up pages -f